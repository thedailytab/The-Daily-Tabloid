<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Account - The Tabloid Times</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Georgia,serif;background:#f5f5f5;padding:20px}
nav{background:#333;padding:10px;margin-bottom:20px;border-radius:8px}
nav a{color:#fff;text-decoration:none;padding:8px 12px;display:inline-block}
.logo{color:#c00;font-weight:bold}
.container{max-width:800px;margin:20px auto;background:#fff;padding:30px;border-radius:8px}
h1{color:#c00;margin-bottom:20px}
h2{color:#333;margin:30px 0 15px 0}
.welcome{background:#e8f5e9;padding:15px;border-radius:8px;margin-bottom:20px}
.logout-btn{background:#666;color:#fff;padding:10px 20px;border:none;border-radius:4px;cursor:pointer;float:right}
.logout-btn:hover{background:#444}
.message-form{background:#f9f9f9;padding:20px;border-radius:8px;margin-bottom:20px}
.message-form input,.message-form textarea{width:100%;padding:10px;margin:8px 0;border:1px solid #ddd;border-radius:4px;font-family:Georgia,serif}
.message-form button{background:#c00;color:#fff;padding:12px 24px;border:none;border-radius:4px;cursor:pointer;font-weight:bold}
.message{background:#fff;border-left:4px solid #c00;padding:15px;margin:10px 0;border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.message-from{font-weight:bold;color:#c00;margin-bottom:8px}
.message-date{color:#666;font-size:0.85em;margin-bottom:8px}
.no-messages{text-align:center;color:#666;padding:30px;font-style:italic}
</style>
</head>
<body>
<nav>
<a href="index.html" class="logo">The Tabloid Times</a>
<a href="about.html">About</a>
<a href="contact.html">Contact</a>
<a href="admin.html">Admin</a>
</nav>
<div class="container">
<button class="logout-btn" onclick="logout()">Logout</button>
<h1>My Account</h1>
<div class="welcome" id="welcome"></div>

<h2>Send Message to User</h2>
<div class="message-form">
<input type="text" id="toUser" placeholder="Username" required>
<textarea id="messageText" placeholder="Your message..." rows="3" required></textarea>
<button onclick="sendMessage()">Send Message</button>
</div>

<h2>My Messages</h2>
<div id="messagesList"></div>
</div>
<script>
function getCurrentUser() {
    const user = localStorage.getItem('current_user');
    return user ? JSON.parse(user) : null;
}

function logout() {
    localStorage.removeItem('current_user');
    window.location.href = 'login.html';
}

function checkAuth() {
    const user = getCurrentUser();
    if (!user) {
        window.location.href = 'login.html';
        return null;
    }
    document.getElementById('welcome').innerHTML = `<strong>Welcome, ${user.username}!</strong>`;
    return user;
}

function loadMessages() {
    const user = getCurrentUser();
    if (!user) return;
    
    const users = JSON.parse(localStorage.getItem('users') || '{}');
    const messages = users[user.username]?.messages || [];
    
    const container = document.getElementById('messagesList');
    if (messages.length === 0) {
        container.innerHTML = '<div class="no-messages">No messages yet</div>';
        return;
    }
    
    container.innerHTML = messages.map(m => `
        <div class="message">
            <div class="message-from">From: ${m.from}</div>
            <div class="message-date">${m.date}</div>
            <div>${m.text}</div>
        </div>
    `).join('');
}

function sendMessage() {
    const user = getCurrentUser();
    if (!user) return;
    
    const toUser = document.getElementById('toUser').value.trim();
    const messageText = document.getElementById('messageText').value.trim();
    
    if (!toUser || !messageText) {
        alert('Please fill in both fields');
        return;
    }
    
    const users = JSON.parse(localStorage.getItem('users') || '{}');
    
    if (!users[toUser]) {
        alert('User not found');
        return;
    }
    
    if (!users[toUser].messages) users[toUser].messages = [];
    users[toUser].messages.unshift({
        from: user.username,
        text: messageText,
        date: new Date().toLocaleString('en-US', {timeZone: 'America/Chicago'})
    });
    
    localStorage.setItem('users', JSON.stringify(users));
    
    alert('Message sent!');
    document.getElementById('toUser').value = '';
    document.getElementById('messageText').value = '';
}

checkAuth();
loadMessages();
</script>
</body>
</html>
